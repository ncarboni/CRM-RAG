{% extends "base.html" %}

{% block title %}Graph Explorer - {{ interface.page_title | default('CIDOC-CRM RAG') }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="../static/css/graph.css">
{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Knowledge Graph Explorer</h5>
                <div class="d-flex align-items-center gap-3">
                    <div class="btn-group" role="group" aria-label="Edge type filter">
                        <input type="radio" class="btn-check" name="edge-type" id="edge-fr" value="fr" checked autocomplete="off">
                        <label class="btn btn-outline-light btn-sm" for="edge-fr">FR Only</label>
                        <input type="radio" class="btn-check" name="edge-type" id="edge-all" value="all" autocomplete="off">
                        <label class="btn btn-outline-light btn-sm" for="edge-all">All Edges</label>
                    </div>
                    <select id="dataset-select" class="form-select form-select-sm" style="width: auto; min-width: 180px;">
                        <option value="" disabled selected>Select Dataset...</option>
                    </select>
                    <span id="dataset-status" class="badge bg-secondary">Not loaded</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Truncation warning -->
<div id="truncation-warning" class="alert alert-warning d-none mb-3">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <span id="truncation-message">Graph was truncated to fit within rendering limits.</span>
</div>

<!-- Graph container -->
<div id="graph-wrapper">
    <div id="graph-container"></div>
    <div id="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="mt-3">Loading graph data...</p>
    </div>
</div>

<!-- Node detail panel (outside graph-wrapper so Cosmograph cannot touch it) -->
<div id="node-detail" class="node-detail d-none">
    <button id="node-detail-close" class="node-detail-close">&times;</button>
    <h6 id="node-detail-label" class="node-detail-label"></h6>
    <div id="node-detail-body" class="node-detail-body"></div>
</div>

<!-- Legend + Stats -->
<div class="row mt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-palette me-2"></i>Fundamental Categories</h6>
            </div>
            <div class="card-body">
                <div id="fc-legend" class="fc-legend"></div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Graph Statistics</h6>
            </div>
            <div class="card-body">
                <div id="graph-stats" class="graph-stats">
                    <p class="text-muted">Select a dataset to view statistics.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block head_extra %}
<script type="importmap">
{
    "imports": {
        "@cosmograph/cosmograph": "https://esm.sh/@cosmograph/cosmograph@2"
    }
}
</script>
{% endblock %}

{% block scripts %}
<script type="module" src="../static/js/graph.js"></script>
{% endblock %}
